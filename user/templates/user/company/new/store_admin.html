{% extends 'base/company/index.html' %}
{% load widget_tweaks %}


{% block pagetitle%}
<div class="pagetitle">
    <h1>Hello, {{ request.session.company_name|default:"Guest" }}!</h1>
    
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#">Home</a></li>
      <li class="breadcrumb-item"><a href="#">Company</a></li>
      <li class="breadcrumb-item active"><a>Users</a></li>
     <li class="breadcrumb-item active"><a>Store Admin</a></li>
    </ol>
  </nav>
</div>
<!-- End Page Title --> 
{% endblock %} 

{% block content %}

<div class="container-fluid">
    
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">User Registration Form</h5>
            
            <div class="p-2">
                <form id = "userForm" method="post" novalidate> 
                    {% csrf_token %}
                    <div class="row mb-3">
                        <label for="name" class="col-sm-3 col-form-label">First Name *</label>
                        <div class="col-sm-9">
                            {% if form.errors.first_name %}
                            {% render_field form.first_name|add_class:"form-control is-invalid"|attr:"id:first_name" %}
                            {% else %}
                            {% render_field form.first_name|add_class:"form-control"|attr:"id:first_name" %}
                            {% endif %}
                            <div id = "" class="invalid-feedback">
                                {{  form.errors.first_name.0  }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <label for="name" class="col-sm-3 col-form-label">Last Name *</label>
                        <div class="col-sm-9">
                            {% if form.errors.last_name %}
                            {% render_field form.last_name|add_class:"form-control is-invalid"|attr:"id:last_name" %}
                            {% else %}
                            {% render_field form.last_name|add_class:"form-control"|attr:"id:last_name" %}
                            {% endif %}
                            <div id ="" class="invalid-feedback">
                                {{  form.errors.last_name.0  }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <label for="name" class="col-sm-3 col-form-label">Email *</label>
                        <div class="col-sm-9">
                            {% if form.errors.email %}
                            {% render_field form.email|add_class:"form-control is-invalid"|attr:"id:email" %}
                            {% else %}
                            {% render_field form.email|add_class:"form-control"|attr:"id:email" %}
                            {% endif %}
                            <div id = "" class="invalid-feedback">
                                {{  form.errors.email.0  }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <label for="name" class="col-sm-3 col-form-label">Phone Number *</label>
                        <div class="col-sm-9">
                            {% if form.errors.phone %}
                            {% render_field form.phone|add_class:"form-control is-invalid"|attr:"id:phone" %}
                            {% else %}
                            {% render_field form.phone|add_class:"form-control"|attr:"id:phone" %}
                            {% endif %}
                            <div id = "" class="invalid-feedback">
                                {{  form.errors.phone.0  }}
                            </div>
                        </div>
                    </div>
                    
                    <hr/>
                    
                    <div class="row mb-3">
                        <label for="roles" class="col-sm-3 col-form-label">Select Role/s *</label>
                        <div class="col-sm-9">
                            <div class ="d-flex">
                                <div class="row">
                                    {% for checkbox in form.roles %}
                                    <div class="col-sm-4">
                                        <div class="form-check">
                                            {{ checkbox }}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% if form.errors.roles %}
                            <div id = "" class="text-danger">
                                {{ form.errors.roles.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr/>
                    
                    <div class="row mb-3">
                        <label for="store" class="col-sm-3 col-form-label">Access to Stores *</label>
                        <div class="col-sm-9">
                            <div class="row"> 
                                {% if form.store|length > 0 %}
                                {% for checkbox in form.store %}
                                <div class="col-sm-4">
                                    <div class="form-check">
                                        {{ checkbox }}
                                    </div>
                                </div>
                                {% endfor %}
                                {% endif %}
                            </div>
                            <div class="row"> 
                                <a href="{% url 'company:company-store-list' company_id=company.id %}" style="width: 250px; height:30px; display: inline-block; text-align: start; text-decoration: none;">
                                    <i class="bi bi-plus"></i><span>Click here to add a store</span>
                                </a>
                            </div>
                            {% if form.errors.store %} 
                            <div class="row text-danger px-2">
                                {{ form.errors.store.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <hr/>

                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="reset" class="btn btn-secondary">Reset</button>
                </div>
                
            </form>
        </div>
    </div>
</div>
</div>

<script type='text/javascript'>
    $(document).ready(function() {
        
        
        function handleAccountTypeSelection() {
            var selectedAccountType = $('input[name="account_type"]:checked').val();
            
            if(selectedAccountType === "Company Admin"){
                $('input[name="roles"]').prop('checked', true);
                $('input[name="roles"]').prop('disabled', true);
            }else if (selectedAccountType === "POS Attendant"){
                $('input[name="roles"]').prop('checked', false);
                $('input[name="roles"]').prop('disabled', false);
                // Enable the selected role checkbox
                var selectedRole = "Cashier";
                $('input[name="roles"][value="' + selectedRole + '"]').prop('disabled', true);
                $('input[name="roles"][value="' + selectedRole + '"]').prop('checked', true);
            }else{
                $('input[name="roles"]').prop('checked', false);
                $('input[name="roles"]').prop('disabled', false);
            }
            
        }
        
        // Attach the function to the change event of the roles checkboxes
        $('input[name="account_type"]').change(handleAccountTypeSelection);
        
        
        function handleRolesSelection() {
            var selectedRoles = $('input[name="roles"]:checked').val();
            
            if(selectedRoles === undefined){
                $('input[name="roles"]').prop('disabled', false);
            }else if (selectedRoles === "Store Manager"){
                // Disable all checkboxes
                $('input[name="roles"]').prop('disabled', true);
                $('input[name="roles"]').prop('checked', false);
                
                // Enable the selected role checkbox
                $('input[name="roles"][value="' + selectedRoles + '"]').prop('disabled', false);
                $('input[name="roles"][value="' + selectedRoles + '"]').prop('checked', true);
                
                // Clear and hide the error message
                $('#rolesError').hide();
            }
            
            
        }
        
        // Attach the function to the change event of the roles checkboxes
        $('input[name="roles"]').change(handleRolesSelection);
        
        
    })
    
</script>
{% endblock %}