{% extends 'base/auth/index.html' %}
{% load static %}

{% block content %}
<div class="container">
    <section class="section register min-vh-100 d-flex flex-column align-items-center justify-content-center py-4">
        <div class="container">
            <div class="row justify-content-end">
                <div class="col-lg-6 col-md-8 d-flex flex-column align-items-center justify-content-center"> 
                    <div class="d-flex justify-content-center py-4">
                        <a href="index.html" class="logo d-flex align-items-center w-auto">
                            <img src="{% static 'img/logo.png'%}" alt="">
                            <span class="d-none d-lg-block">MyPharmacy</span>
                        </a>
                    </div>
                    <!-- End Logo -->
                    
                    <div class="card mb-3">
                        
                        <div class="card-body">
                            
                            <div class="pt-4 pb-2">
                                <h5 class="card-title text-center pb-0 fs-4">Login to Your Account</h5>
                                <p class="text-center small">Enter your email & password to login</p>
                            </div>
                            
                            {% if messages %}
                            {% for message in messages %}

                           <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                               {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>

                            {% endfor %}
                            {% endif %}

                           {% comment %} <div class="alert alert-success" role="alert">
                                {{ message }}
                            </div> {% endcomment %}
                            
                            <form id="userForm" class="row g-3 needs-validation1" method="post" novalidate>
                                {% csrf_token %}
                                
                                <div class="col-12">
                                    <label for="email" class="form-label">Email address</label>
                                    <div class="input-group has-validation">
                                        <span class="input-group-text" id="inputGroupPrepend">@</span>
                                        <input type="email" name="email" class="form-control" id="email">
                                        <div id = "emailError" class="invalid-feedback">Please enter your email.</div>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <label for="password" class="form-label">Password</label>
                                    <input type="password" name="password" class="form-control" id="password">
                                    <div id = "passwordError" class="invalid-feedback">Please enter your password!</div>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="remember" value="true" id="rememberMe">
                                        <label class="form-check-label" for="rememberMe">Remember me</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button class="btn btn-primary w-100" type="submit">Login</button>
                                </div>
                                <div class="col-12">
                                    <p class="small mb-0">Forgot Password? <a href="{% url 'reset_password' %}">Reset</a></p>
                                </div>
                                <div class="col-12">
                                    <p class="small mb-0">Want to be a member? <a href="{% url 'company:company-application-register' %}">Apply Here</a></p>
                                </div>
                            </form>
                            
                        </div>
                    </div>
                    
                    <div class="credits">
                        <!-- All the links in the footer should remain intact. -->
                        <!-- You can delete the links only if you purchased the pro version. -->
                        <!-- Licensing information: https://bootstrapmade.com/license/ -->
                        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
                        {% comment %} Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a> {% endcomment %}
                    </div>
                    
                </div>
            </div>
        </div>
        
    </section>
    
</div>

<script>
    // Your custom email validation function
    function isValidEmail(email) {
        // Use a regular expression to check if the email is valid
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const isValid = emailRegex.test(email);
        return isValid;
    }
    
    function validateEmail() {
        var emailValue = $('#email').val();
        
        if (!isValidEmail(emailValue)) {
            $('#email').removeClass('is-valid').addClass('is-invalid');
            $('#emailError').text("Please provide a valid email address");
            return false;
        } else {
            $('#email').removeClass('is-invalid').addClass('is-valid');
            return true;
        }
    }
    
    function validatePassword() {
        var passwordValue = $('#password').val();
        
        if (passwordValue.trim().length < 5) {
            $('#password').removeClass('is-valid').addClass('is-invalid');
            $('#passwordError').text("Please provide a valid password, at least 5 characters");
            return false;
        } else {
            $('#password').removeClass('is-invalid').addClass('is-valid');
            return true;
        }
    }
    
    $(document).ready(function(){
                $('.toast').toast('show');

        $("#userForm").submit(function(e){
            e.preventDefault()
            $('#userForm').removeClass('was-validated');
            
            // Run the validation functions before submission
            const emailValid =  validateEmail();
            const passValid = validatePassword(); 
            
            if(emailValid && passValid){
                this.submit()
            }
        })
    })
</script>
{% endblock %}